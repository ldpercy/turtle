Settings in localStorage
========================


Add more settings to localStorage.

```
2025-10-22		New Task
2025-10-27		Done
```


Ideas:
* Create a settings structure for the command box, page and drawing settings
* Save the settings when the page visibility changes (~unload)
* Load the settings on page load
* Possibly have separate light and dark mode settings for the grids, colour and stroke width
* Multiple command buffers - be able to switch between a few command sets (also saved)



visibilitychange & formdata
---------------------------

Have added a `visibilitychange` listener that now saves info from the page and drawing forms.

The transition to hidden is the modern equivalent of the unload event.

The internet suggested creating a FormData object directly out of the forms and serialising that, so trying that now.
Not used FormData before, think it's part of XHR.

Something weird was happening with it yesterday, it was including the prototype, not doing it now though, not sure why.

Unfortunately I don't think there's an easy reverse equivalent for populating a form from some data, but writing one will be quick.


HTMLApp buildElements
---------------------

I've added a buildElements method to the HTMLApp to set up references for commonly reused elements so document.getElementById('foo') doesn't have to be called all the time.
I don't know if this actually saves much other than some visual clutter, but will try it out for a while.
It might prove more more confusing in some ways because i have to maintain two sets of names, will see.


Saving and reloading form data
------------------------------

Hmm there's a few complications with FormData - they were some noted on the SO page i was referencing, need to review.

> https://stackoverflow.com/a/55874235

For one thing, unchecked checkboxes don't get included - I'd prefer they were.

	formData = new FormData(formElement);
	formDataObject = Object.fromEntries(formData),


Also radio inputs need to be handled differently...
I've rolled my own for now.

Need to figure out a decent way to handle themes at load time too.


Chrome & firefox style parity
-----------------------------

Never been a terribly high priority for me, but I've added a few things to bring them more in line with each other:
* set accent colours for light and dark
* Tweaking some font sizes
* Adding 'Noto sans' as preferred san-serif font

The font sizes will need more testing though, I don't mess around with those very often, and have forgotten how some things work.

I read somewhere that the default font-size used by a lot of browsers is 16px, going to set that to make it clear.
Also should probably shift to using `rem` and `rex` for some things instead of `em` and `ex` that i'm in the habit of using.


Command sets
------------

I have three command sets going now with an el-cheapo tabbed ui under the textarea.
Works okay so far, and they'll also be included in the localstorage saving which is nice.

I think I might want to do some input cleaning/validation for these - people could try dropping arbitrary code in there, or overloading it or god knows whatever else.
I can't do a whole lot to stop anyone who knows what they're doing, and it'll *probably* only be their own computer affected, but I'll add some cleaning just in case.

For instance if someone could edit someone else's localstorage while they're away from their pc?
There are probably easier ways tbh if you have that access.
But I'm curious anyway - should try to find a sqllite viewer.



Wrapup
------


* Now using `visibilitychange` to `hidden` to save page settings
* Have rolled my own form data and form populate fns for HTMLApp to handle things like radios and checkboxes
* Also added a `buildElements` to create commonly reused element references
* Have added specific light and dark accent colours to bring Chrome and Firefox styling more in line
* Also some font and size changes in the same vein
* Have added 3 tabs to swap between command set buffers, also saved to localstorage


Follow up
* Chrome complaining about checkboxes in summary: "Interactive element inside of a <summary> element"
* Input validation/cleaning for the command box and strings

