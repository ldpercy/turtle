Turtle follows mouse üê¢üëâüê≠
===========================

```
2025-11-14		0.8				Done
```


A random idea I had, not really traditional turtle at all.
Click the mouse on the page, and the turtle goes there.

The main problem for me are the page transforms I'm using, so converting a document click event's coordinates to local page points seems like a pretty hard problem.
Nonetheless, there are a couple of leads out there that seem to suggest that something like this might be possible, so I thought I'd check it out.


https://stackoverflow.com/questions/10298658/mouse-position-inside-autoscaled-svg
https://phrogz.net/svg/drag_under_transformation.xhtml
https://developer.mozilla.org/en-US/docs/Web/API/SVGGraphicsElement/getScreenCTM


From the first:
```js
// Find your root SVG element
var svg = document.querySelector('svg');

// Create an SVGPoint for future math
var pt = svg.createSVGPoint();

// Get point in global SVG space
function cursorPoint(evt){
  pt.x = evt.clientX; pt.y = evt.clientY;
  return pt.matrixTransform(svg.getScreenCTM().inverse());
}

svg.addEventListener('mousemove',function(evt){
  var loc = cursorPoint(evt);
  // Use loc.x and loc.y here
},false);
```


https://stackoverflow.com/questions/69916593/what-is-the-replacement-for-the-deprecated-svgpoint-javascript-api



*It works.*


It works
--------

Yeah okay tbh didn't think it would be that quick or easy...
To be fair, it's only easy because whoevever designed the SVG apis did a darn solid job of it, so kudos to that guy.

So what to do with this now...

I think I'll try to implement the follows idea, but how it gets integrated into the main UI not sure yet.
To begin with should probably be an option that is off by default.
There's also whether it should draw or jump, and I want both I think, so need to sort that out as well.
As well as precision...

I'll start by having a click leave a single point marker on the page that moves to wherever you click.
You could have multiple, an array or groups etc, but just one for now.


Point markers
-------------

Have added a quick spot dropper, needs some work.
Thinking about changing them to a fuzzy point with a radial gradient.
The multiple points idea isn't too bad, but it would need a cleaner button, think I'll just change it to overwrite for now.

This also reminds me that the SVGTurtle isn't properly abstracted from the cartesian space yet.


### Update hover

Have changed over to use some planar space point math to get the polar position for the point as well - pretty cool.

The angle is reporting negative in the second quadrant (cw) though, need to fix that so it's positive instead.
Actually might need some sort of solution for angle reporting generally - the polar grid angles go from 0 to 360, so they're inconsistent too.
It's mostly a presentational matter though.


### Axis lines

Quickly added some dashed lines to the cartesian axes which look kind of neat.
But it immediately suggests a few things:
* Adding polar lines & angles as well
* Polar representation would need to be standardised or have options: 0 < a < 360 / -180 < a < 180
* Points and lines should probably be depedant on grid-type visibility
* Customising color + weight and/or zoom reactivity

For now I'm going to group points and lines with their respective grids so that visibility is applied together, but opinions may vary on this one.


### Aside: Display point?

Still need a consistent way of transforming abstract space points into points for display on the drawing area.
In the past having an SVGPoint extension proved not super good, at the time at least, but i do need something like it somewhere.
Maybe just having a more abstract `DisplayPoint` with is own transform, possibly as an extension, might be a better approach.
Will ponder.


### Points Lines

Point lines are now only on or off with their grids (no opacity changes) - works better for my brain.
Need to add a way to clear the points though - either click it to remove it or a clear button.
Click to clear is probably more complicated as at the moment there are two points being drawn, and click is more likely to be useful for other things.
I'll just add a clear button for now, but this will probably be temporary.


Turtle moving
-------------

As I said at the top, this is a bit of a step away from traditional turtle implementations, but it's all definitely related in terms of geometry, so happy to keep exploring.

I can already foresee a bunch of potential things that could be done with this such as recording and turning the moves into commands, but I'll start with a simple version.

There is a move command I'll need first though so will have to poach it from the [new commands](<new commands.md>) task:

* go to x,y plus set polar

While I'm thinking about it, move commands could be grouped in few ways.

* Command thoughts over in [new commands](<new commands.md>)


### Bring it back

Spent a bit of time [thinking about movement maths](<variables and maths.md>) (still thinking about it).
It's a work in progress, and it's helping clarify some things i think, but proper results will come later.

So this doesn't hang indefintely i'll try to bring a little of it back here and keep going:
* Create another class in PlanarSpace for positions - combined location and direction
* Try to move some of the core turtle movement maths to the position class
* The new movement command I need right now doesn't have to be perfect, just functional
* The movement is to an absolute/page position, which includes setting a direction that represents the previous->new line



Position Class
--------------

Have made a start on this, but done quickly and not very elegant yet.
I keep butting in weird cases where I dont' seem to be able to read through getters properly - not sure if it's programmer error (there was a typo I found) or if there's something I'm still not understanding properly.
Keep an eye on.

For now it's a bit of a hodge-podge of hacks to make things work, but the terminology all needs to be cleaned and tightened up.
For example heading/bearing/direction - need to stop aliasing these and come up a clear use for each.
There are (iiuc) cases in navigation where heading and direction differ, such as in the presence of wind/sea currents.
This isn't likely to be relevant any time soon, but in a space that's highly rounded/snapped (~quantised) it might, or other kinds of pressures/resistances.
Just something to be conscious of.
Probably better for now to stick with direction though, as it's the plainer/commoner idea, and more in keeping with the position math I'm going for right now.

* Have updated all the code to use 'direction' instead of heading, looking a bit nicer


Move to X,Y
-----------

This is the main show here.
Need a command and some appropriate position/point math to say "go to this new spot".

The spot will be a *point* as described by a cartesian pair, either from a command or a mouse click.

For the purposes of this task the direction of the turtle will also be updated to point along the previous-new line.

An non-rotating version of this will be added later.

The old 'move' command will prob need a better name pretty soon, something like movedxdy.


* I've tentatively added two new comamnds 'xy' and 'xyr' for moving to xy coords without/with a corresponding rotation

Kind of have something working, though...

### Click event weirdness

There's something weird going on with the click events - in some circumstances the dbl will/won't fire after the single click events.

It seems to change depending on whether I add in a 'this.' handler call in the single click listener - like it's cancelling the subsequent dbl event.
This is new magic - need to find out what's happening.


Small diversion into command parsing
--------------------------------
Think I need to bring in a few of the ideas from [new commands](<new commands.md>).
I don't want to invest too heavily in it yet as a lot is still pretty tentative, just try one or two things out.

* I've added an optional `^` prefix flag indicating to move but not draw

Still thinking about arithmetic prefixes to indicate operators `+` `-` `=`, plus being the implied default.

Need to be more clear about a few things first though, so not just yet.



Basic mouse clicks working
--------------------------

So anyway, it's working, and I can choose between a few click modes now.
It doesn't feel super cohesive or clean from a UX perspective, but it's a start.
Also it does kind of distract a bit from the main turtle command aspect - if you were to give it to students you might want to turn off or hide the mouse tracking.

However, being able to see/use and edit the commands generated by the mouse clicks *would* be really beneficial.
That would turn it into less of a gimmick and more of a tool.
But what the UI for that would be I don't have much of an idea about yet.


* Have shifted the colours around a little, the point info lines have gained the purple and the polar grid is now pink (less aggressive than before)



I think I'll clean it up a bit and push it out pretty soon.

The point info lines need a quick revisit, and if i can get some of the angle addition into a +-180 degree range that would be nice, but I might come back to that one.



Wrapup
------

Going to wrap this up here, I really want to fix the rotation, but I'd rather fix a few different related issues together with that one so will hold off.

Summary
* Getting svg coordinates from a transformed document works
* Added a simple point info dropper for the clicked page location; it has cartesian and polar parts that switch off with their respective grids; there is also a clear button for it
* Still manually flipping some y-coords for SVG though - still needs a proper treatment
* A aside into trying to figure out a more consistent syntax for certain commands categories
* An even bigger diversion into trying to work some of the more abstract maths behind turtle movement - some useful ideas, but still in progress
* For now I'm distinguishing between points (x,y or r,a) and positions that also incorporate a direction or orientation
* For now I'm dropping 'heading' terminology in favour of 'direction' to make things super clear, might bring heading back later though
* New 'Position' class in PlanarSpace, starting to move some core Turtle maths to it; more as i figure it out properly
* Added a couple of new commands for moving to absolute x,y coords with/without drawing; all the syntax for this is still a bit up in the air
* There was/is a bit of weirdness around click events when i had both single and double clicks registered - in some cases the dbl didn't fire, and I haven't found out what's causing it yet. For now sticking with single clicks for everything.
* Have four options for page clicks - nothing, point info, move and draw. This will need to reviewed in the future though.
* Adjust colours a bit.
